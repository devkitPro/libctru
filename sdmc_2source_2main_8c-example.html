<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libctru: sdmc/source/main.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libctru<span id="projectnumber">&#160;v2.6.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">sdmc/source/main.c</div></div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">///////////////////////////////////////</span></div>
<div class="line"><span class="comment">//           SDMC example            //</span><span class="comment"></span></div>
<div class="line"><span class="comment">///////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">//this example shows you how to load a binary image file from the SD card and display it on the lower screen</span></div>
<div class="line"><span class="comment">//for this to work you should copy test.bin to same folder as your .3dsx</span></div>
<div class="line"><span class="comment">//this file was generated with GIMP by saving a 240x320 image to raw RGB</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="3ds_8h.html">3ds.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;costable.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//this will contain the data read from SDMC</span></div>
<div class="line"><a class="code hl_typedef" href="types_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* buffer;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//3DS has VFPs so we could just use cos</span></div>
<div class="line"><span class="comment">//but we&#39;re old school so LUT4life</span></div>
<div class="line"><a class="code hl_typedef" href="types_8h.html#ae9b1af5c037e57a98884758875d3a7c4">s32</a> pcCos(<a class="code hl_typedef" href="types_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a> v)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> costable[v&amp;0x1FF];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> renderEffect()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> cnt;</div>
<div class="line">    <a class="code hl_typedef" href="types_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a>* bufAdr=<a id="a0" name="a0"></a><a class="code hl_function" href="gfx_8h.html#a712a0be6982c606c6cbdeba61b60941e">gfxGetFramebuffer</a>(<a id="a1" name="a1"></a><a class="code hl_enumvalue" href="gfx_8h.html#a356112d87f5cf6bbba3ea3b6b010e09caf9d44178134d07cf9c5923200e14af09">GFX_TOP</a>, <a id="a2" name="a2"></a><a class="code hl_enumvalue" href="gfx_8h.html#ab9bacc1d598f0f6e4d5ef8bbeb466b03a1bfda6a35adc49eb4631246ea4e637e1">GFX_LEFT</a>, NULL, NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> i, j;</div>
<div class="line">    <span class="keywordflow">for</span>(i=1;i&lt;400;i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span>(j=1;j&lt;240;j++)</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_typedef" href="types_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> v=(j+i*240)*3;</div>
<div class="line">            bufAdr[v]=(pcCos(i+cnt)+4096)/32;</div>
<div class="line">            bufAdr[v+1]=(pcCos(j-256+cnt)+4096)/64;</div>
<div class="line">            bufAdr[v+2]=(pcCos(i+128-cnt)+4096)/32;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    cnt++;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    <a id="a3" name="a3"></a><a class="code hl_function" href="gfx_8h.html#a236a005ae029247c8bfe4a4a649206fc">gfxInitDefault</a>(); <span class="comment">//makes displaying to screen easier</span></div>
<div class="line"> </div>
<div class="line">    FILE *file = fopen(<span class="stringliteral">&quot;test.bin&quot;</span>,<span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (file == NULL) <span class="keywordflow">goto</span> exit;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// seek to end of file</span></div>
<div class="line">    fseek(file,0,SEEK_END);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// file pointer tells us the size</span></div>
<div class="line">    off_t size = ftell(file);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// seek back to start</span></div>
<div class="line">    fseek(file,0,SEEK_SET);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//allocate a buffer</span></div>
<div class="line">    buffer=malloc(size);</div>
<div class="line">    <span class="keywordflow">if</span>(!buffer)<span class="keywordflow">goto</span> exit;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//read contents !</span></div>
<div class="line">    off_t bytesRead = fread(buffer,1,size,file);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//close the file because we like being nice and tidy</span></div>
<div class="line">    fclose(file);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(size!=bytesRead)<span class="keywordflow">goto</span> exit;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span>(<a id="a4" name="a4"></a><a class="code hl_function" href="apt_8h.html#a84808c36d9a8c389896ecf241c7f89cb">aptMainLoop</a>())</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//exit when user hits B</span></div>
<div class="line">        <a id="a5" name="a5"></a><a class="code hl_function" href="hid_8h.html#abbbf0e1f3a79a75e459e19f85a66bee6">hidScanInput</a>();</div>
<div class="line">        <span class="keywordflow">if</span>(<a id="a6" name="a6"></a><a class="code hl_define" href="hid_8h.html#ab34b448187933ef0752cac666453a6e4">keysHeld</a>()&amp;<a id="a7" name="a7"></a><a class="code hl_enumvalue" href="hid_8h.html#a9334a5b9057f32da96db9b5c6a045d67a10072b5ee7aa1faf316434ecc9e2bb3a">KEY_B</a>)<span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">//render rainbow</span></div>
<div class="line">        renderEffect();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">//copy buffer to lower screen (don&#39;t have to do it every frame)</span></div>
<div class="line">        memcpy(<a class="code hl_function" href="gfx_8h.html#a712a0be6982c606c6cbdeba61b60941e">gfxGetFramebuffer</a>(<a id="a8" name="a8"></a><a class="code hl_enumvalue" href="gfx_8h.html#a356112d87f5cf6bbba3ea3b6b010e09cac1be8c2dee1ab5520b30ba069afa7541">GFX_BOTTOM</a>, <a class="code hl_enumvalue" href="gfx_8h.html#a356112d87f5cf6bbba3ea3b6b010e09cac1be8c2dee1ab5520b30ba069afa7541">GFX_BOTTOM</a>, NULL, NULL), buffer, size);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">//wait &amp; swap</span></div>
<div class="line">        <a id="a9" name="a9"></a><a class="code hl_function" href="gfx_8h.html#a3306df28835a647734cf8e299f041527">gfxSwapBuffersGpu</a>();</div>
<div class="line">        <a id="a10" name="a10"></a><a class="code hl_function" href="gspgpu_8h.html#a91a03ad378747bc554ff611742727958">gspWaitForEvent</a>(<a id="a11" name="a11"></a><a class="code hl_enumvalue" href="gspgpu_8h.html#a02ba699764336c8df7f8910921d478cba6b9085683ccf233f10da885153998dc6">GSPGPU_EVENT_VBlank0</a>, <span class="keyword">false</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//cleanup and return</span></div>
<div class="line">    <span class="comment">//returning from main() returns to hbmenu when run under ninjhax</span></div>
<div class="line">    exit:</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//closing all services even more so</span></div>
<div class="line">    <a id="a12" name="a12"></a><a class="code hl_function" href="gfx_8h.html#aa446ccfdfdd4c575e648956ae96f2a3b">gfxExit</a>();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="a3ds_8h_html"><div class="ttname"><a href="3ds_8h.html">3ds.h</a></div><div class="ttdoc">Central 3DS header.</div></div>
<div class="ttc" id="aapt_8h_html_a84808c36d9a8c389896ecf241c7f89cb"><div class="ttname"><a href="apt_8h.html#a84808c36d9a8c389896ecf241c7f89cb">aptMainLoop</a></div><div class="ttdeci">bool aptMainLoop(void)</div><div class="ttdoc">Main function which handles sleep mode and HOME/power buttons - call this at the beginning of every f...</div></div>
<div class="ttc" id="agfx_8h_html_a236a005ae029247c8bfe4a4a649206fc"><div class="ttname"><a href="gfx_8h.html#a236a005ae029247c8bfe4a4a649206fc">gfxInitDefault</a></div><div class="ttdeci">void gfxInitDefault(void)</div><div class="ttdoc">Initializes the LCD framebuffers with default parameters This is equivalent to calling:</div></div>
<div class="ttc" id="agfx_8h_html_a3306df28835a647734cf8e299f041527"><div class="ttname"><a href="gfx_8h.html#a3306df28835a647734cf8e299f041527">gfxSwapBuffersGpu</a></div><div class="ttdeci">void gfxSwapBuffersGpu(void)</div><div class="ttdoc">Same as gfxSwapBuffers (formerly different).</div></div>
<div class="ttc" id="agfx_8h_html_a356112d87f5cf6bbba3ea3b6b010e09cac1be8c2dee1ab5520b30ba069afa7541"><div class="ttname"><a href="gfx_8h.html#a356112d87f5cf6bbba3ea3b6b010e09cac1be8c2dee1ab5520b30ba069afa7541">GFX_BOTTOM</a></div><div class="ttdeci">@ GFX_BOTTOM</div><div class="ttdoc">Bottom screen.</div><div class="ttdef"><b>Definition</b> gfx.h:27</div></div>
<div class="ttc" id="agfx_8h_html_a356112d87f5cf6bbba3ea3b6b010e09caf9d44178134d07cf9c5923200e14af09"><div class="ttname"><a href="gfx_8h.html#a356112d87f5cf6bbba3ea3b6b010e09caf9d44178134d07cf9c5923200e14af09">GFX_TOP</a></div><div class="ttdeci">@ GFX_TOP</div><div class="ttdoc">Top screen.</div><div class="ttdef"><b>Definition</b> gfx.h:26</div></div>
<div class="ttc" id="agfx_8h_html_a712a0be6982c606c6cbdeba61b60941e"><div class="ttname"><a href="gfx_8h.html#a712a0be6982c606c6cbdeba61b60941e">gfxGetFramebuffer</a></div><div class="ttdeci">u8 * gfxGetFramebuffer(gfxScreen_t screen, gfx3dSide_t side, u16 *width, u16 *height)</div><div class="ttdoc">Retrieves the framebuffer of the specified screen to which graphics should be rendered.</div></div>
<div class="ttc" id="agfx_8h_html_aa446ccfdfdd4c575e648956ae96f2a3b"><div class="ttname"><a href="gfx_8h.html#aa446ccfdfdd4c575e648956ae96f2a3b">gfxExit</a></div><div class="ttdeci">void gfxExit(void)</div><div class="ttdoc">Deinitializes and frees the LCD framebuffers.</div></div>
<div class="ttc" id="agfx_8h_html_ab9bacc1d598f0f6e4d5ef8bbeb466b03a1bfda6a35adc49eb4631246ea4e637e1"><div class="ttname"><a href="gfx_8h.html#ab9bacc1d598f0f6e4d5ef8bbeb466b03a1bfda6a35adc49eb4631246ea4e637e1">GFX_LEFT</a></div><div class="ttdeci">@ GFX_LEFT</div><div class="ttdoc">Left eye framebuffer.</div><div class="ttdef"><b>Definition</b> gfx.h:37</div></div>
<div class="ttc" id="agspgpu_8h_html_a02ba699764336c8df7f8910921d478cba6b9085683ccf233f10da885153998dc6"><div class="ttname"><a href="gspgpu_8h.html#a02ba699764336c8df7f8910921d478cba6b9085683ccf233f10da885153998dc6">GSPGPU_EVENT_VBlank0</a></div><div class="ttdeci">@ GSPGPU_EVENT_VBlank0</div><div class="ttdoc">TODO.</div><div class="ttdef"><b>Definition</b> gspgpu.h:56</div></div>
<div class="ttc" id="agspgpu_8h_html_a91a03ad378747bc554ff611742727958"><div class="ttname"><a href="gspgpu_8h.html#a91a03ad378747bc554ff611742727958">gspWaitForEvent</a></div><div class="ttdeci">void gspWaitForEvent(GSPGPU_Event id, bool nextEvent)</div><div class="ttdoc">Waits for a GSPGPU event to occur.</div></div>
<div class="ttc" id="ahid_8h_html_a9334a5b9057f32da96db9b5c6a045d67a10072b5ee7aa1faf316434ecc9e2bb3a"><div class="ttname"><a href="hid_8h.html#a9334a5b9057f32da96db9b5c6a045d67a10072b5ee7aa1faf316434ecc9e2bb3a">KEY_B</a></div><div class="ttdeci">@ KEY_B</div><div class="ttdoc">B.</div><div class="ttdef"><b>Definition</b> hid.h:13</div></div>
<div class="ttc" id="ahid_8h_html_ab34b448187933ef0752cac666453a6e4"><div class="ttname"><a href="hid_8h.html#ab34b448187933ef0752cac666453a6e4">keysHeld</a></div><div class="ttdeci">#define keysHeld</div><div class="ttdoc">Compatibility macro for hidKeysHeld.</div><div class="ttdef"><b>Definition</b> hid.h:174</div></div>
<div class="ttc" id="ahid_8h_html_abbbf0e1f3a79a75e459e19f85a66bee6"><div class="ttname"><a href="hid_8h.html#abbbf0e1f3a79a75e459e19f85a66bee6">hidScanInput</a></div><div class="ttdeci">void hidScanInput(void)</div><div class="ttdoc">Scans HID for input data.</div></div>
<div class="ttc" id="atypes_8h_html_a92c50087ca0e64fa93fc59402c55f8ca"><div class="ttname"><a href="types_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a></div><div class="ttdeci">uint8_t u8</div><div class="ttdoc">would be nice if newlib had this already</div><div class="ttdef"><b>Definition</b> types.h:21</div></div>
<div class="ttc" id="atypes_8h_html_ace9d960e74685e2cd84b36132dbbf8aa"><div class="ttname"><a href="types_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a></div><div class="ttdeci">uint16_t u16</div><div class="ttdoc">16-bit unsigned integer</div><div class="ttdef"><b>Definition</b> types.h:22</div></div>
<div class="ttc" id="atypes_8h_html_ae9b1af5c037e57a98884758875d3a7c4"><div class="ttname"><a href="types_8h.html#ae9b1af5c037e57a98884758875d3a7c4">s32</a></div><div class="ttdeci">int32_t s32</div><div class="ttdoc">32-bit signed integer</div><div class="ttdef"><b>Definition</b> types.h:28</div></div>
<div class="ttc" id="atypes_8h_html_afaa62991928fb9fb18ff0db62a040aba"><div class="ttname"><a href="types_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a></div><div class="ttdeci">uint32_t u32</div><div class="ttdoc">32-bit unsigned integer</div><div class="ttdef"><b>Definition</b> types.h:23</div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
